<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SharePoint 2019 Multi-VM Lab Setup + PoC Exploit Test Guide</title>
<style>
  body { font-family: Arial, sans-serif; background:#f7f9fc; padding:20px; line-height:1.6; }
  h1, h2, h3 { color:#2c3e50; }
  pre { background:#2d2d2d; color:#f8f8f2; padding:15px; border-radius:6px; overflow-x:auto; }
  code { color:#e67e22; font-weight: bold; }
  ul { margin-bottom:20px; }
  .note { background:#f1c40f; padding:12px; border-radius:6px; margin:20px 0; }
  .section-marker {
    background:#3498db;
    color:white;
    padding:10px 15px;
    margin: 20px 0 10px;
    font-weight:bold;
    border-radius: 4px;
  }
  .cmd, .ps {
    font-weight: bold;
  }
  .cmd { color: #27ae60; }
  .ps { color: #2980b9; }
</style>
</head>
<body>

<h1>SharePoint Server 2019 Multi-VM Lab Setup with PoC Exploit Test</h1>
<p>Need to install: Windows Server 2019 (Standard & Datacenter) for your VM machines!</p>

<p>This guide will help you build a SharePoint 2019 lab with 3 VMs on Windows Server 2019:</p>
<ul>
  <li><strong>DC-Lab:</strong> Domain Controller (Active Directory + DNS)</li>
  <li><strong>SQL-Lab:</strong> SQL Server 2017/2019</li>
  <li><strong>SP-Lab:</strong> SharePoint Server 2019</li>
</ul>

<p>Each VM runs Windows Server 2019. The domain will be <code>corp.local</code>.</p>

<hr />

<h2>1. Setup Domain Controller VM (DC-Lab)</h2>

<div class="section-marker">Start: DC-Lab Installation</div>

<ol>
  <li><strong>Install Windows Server 2019</strong> and rename computer:</li>
  <pre><code class="ps">Rename-Computer -NewName "DC-Lab" -Restart</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span> — Run this inside an elevated PowerShell window.</p>

  <li><strong>Set static IP:</strong> Use your VM network adapter settings or run PowerShell commands below:</li>
  <pre><code class="ps">New-NetIPAddress -InterfaceAlias "Ethernet" -IPAddress 192.168.1.10 -PrefixLength 24 -DefaultGateway 192.168.1.1
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 192.168.1.10</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span> — Elevated PowerShell is required to change IP settings.</p>

  <li><strong>Install Active Directory Domain Services and DNS roles:</strong></li>
  <pre><code class="ps">Install-WindowsFeature AD-Domain-Services, DNS -IncludeManagementTools</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span> — This installs the necessary roles.</p>

  <li><strong>Promote to Domain Controller:</strong> Use this command (adjust password):</li>
  <pre><code class="ps">Install-ADDSForest -DomainName "corp.local" -SafeModeAdministratorPassword (ConvertTo-SecureString "p@ssw0rd" -AsPlainText -Force) -Force</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span> — This promotes the server to a DC and will restart the machine.</p>

  <li>After reboot, log in as <code>corp\Administrator</code>.</li>

  <li><strong>Verify AD and DNS services are running:</strong></li>
  <pre><code class="ps">Get-Service -Name NTDS, DNS</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span> — Confirm that key services are up.</p>
</ol>

<div class="section-marker">Finish: DC-Lab Installation</div>

<hr />

<h2>2. Setup SQL Server VM (SQL-Lab)</h2>

<div class="section-marker">Start: SQL-Lab Installation</div>

<ol>
  <li><strong>Install Windows Server 2019</strong> and rename:</li>
  <pre><code class="ps">Rename-Computer -NewName "SQL-Lab" -Restart</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span></p>

  <li><strong>Set static IP:</strong></li>
  <pre><code class="ps">New-NetIPAddress -InterfaceAlias "Ethernet" -IPAddress 192.168.1.20 -PrefixLength 24 -DefaultGateway 192.168.1.1
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 192.168.1.10</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span></p>

  <li><strong>Join domain:</strong></li>
  <pre><code class="ps">Add-Computer -DomainName "corp.local" -Restart</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span></p>

  <li><strong>Install prerequisites for SQL Server:</strong></li>
  <pre><code class="ps">Install-WindowsFeature NET-Framework-45-Core, NET-Framework-45-ASPNET, Web-Server, Web-Asp-Net45</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span></p>

  <li><strong>Install SQL Server 2017/2019:</strong>
    <ul>
      <li>Download the SQL Server installer from the official Microsoft website.</li>
      <li>Run the installer with administrative privileges.</li>
      <li>Choose <code>New SQL Server stand-alone installation</code> or add features to an existing installation.</li>
      <li>Accept license terms and click <code>Next</code>.</li>
      <li>On <strong>Feature Selection</strong>, select at least <code>Database Engine Services</code>. You can also select <code>Management Tools</code> if needed.</li>
      <li>On <strong>Instance Configuration</strong>, choose <code>Default instance</code> or specify a named instance.</li>
      <li>On <strong>Server Configuration</strong>, set the SQL Server service accounts and startup types (default is fine for lab setups).</li>
      <li>On <strong>Database Engine Configuration</strong>:
        <ul>
          <li>Set <strong>Authentication Mode</strong> to <code>Mixed Mode (SQL Server authentication and Windows authentication)</code>.</li>
          <li>Enter a strong password for the <code>sa</code> account.</li>
          <li><strong>Add your domain administrator account(s) as SQL Server administrators:</strong> In the <em>Database Engine Configuration &gt; Server Roles</em> step, click <em>Add...</em> and enter your domain admin username(s), e.g. <code>CORP\Administrator</code>.</li>
        </ul>
      </li>
      <li>Complete the installation and restart the server if prompted.</li>
      <li>Verify SQL Server service is running (adjust service name if you used a named instance):</li>
      <pre><code class="ps">Get-Service -Name MSSQLSERVER  # Default instance
# Or for named instance (e.g. SQLEXPRESS):
Get-Service -Name 'MSSQL$SQLEXPRESS'</code></pre>
    </ul>
  </li>

  <li><strong>Open SQL Server TCP port 1433 in firewall:</strong></li>
  <pre><code class="ps">New-NetFirewallRule -DisplayName "SQL Server" -Direction Inbound -Protocol TCP -LocalPort 1433 -Action Allow</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span></p>

  <li><strong>Restart SQL Server service if needed (use -Force if dependent services block stop):</strong></li>
  <pre><code class="ps">Restart-Service -Name MSSQLSERVER
# Or for named instance:
Restart-Service -Name 'MSSQL$SQLEXPRESS' -Force</code></pre>
  <p class="note"><span class="ps">PowerShell (Admin)</span> — Use <code>-Force</code> if you get dependent services errors.</p>

  <li><strong>IMPORTANT:</strong> Make sure the Windows Server is <em>fully updated</em> with all latest patches before continuing.</li>
</ol>

<div class="section-marker">Finish: SQL-Lab Installation</div>

<hr />

<h2>3. Setup SharePoint Server VM (SP-Lab)</h2>

<div class="section-marker">Start: SP-Lab Installation</div>

<ol>
  <li><strong>Install Windows Server 2019</strong> and rename:</li>
  <pre><code class="ps">Rename-Computer -NewName "SP-Lab" -Restart</code></pre>

  <li><strong>Set static IP:</strong></li>
  <pre><code class="ps">New-NetIPAddress -InterfaceAlias "Ethernet" -IPAddress 192.168.1.30 -PrefixLength 24 -DefaultGateway 192.168.1.1
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 192.168.1.10</code></pre>

  <li><strong>Join domain:</strong></li>
  <pre><code class="ps">Add-Computer -DomainName "corp.local" -Restart</code></pre>

  <li><strong>Install required Windows Features for SharePoint:</strong></li>
  <pre><code class="ps">Install-WindowsFeature Web-Server, Web-WebServer, Web-Common-Http, Web-Default-Doc, Web-Static-Content, Web-Http-Errors, Web-ASP-Net45, Web-Net-Ext45, Web-ISAPI-Ext, Web-ISAPI-Filter, Web-Includes, Web-WebSockets, Web-Mgmt-Console, NET-Framework-45-Core, NET-Framework-45-ASPNET, Windows-Identity-Foundation</code></pre>

  <li><strong>Restart if prompted.</strong></li>

  <li><strong>Install SharePoint Server 2019 prerequisites:</strong>
    <ul>
      <li>Download SharePoint 2019 prerequisites installer from Microsoft.</li>
      <li>Run <code>prerequisiteinstaller.exe</code> as administrator.</li>
      <li>After it completes, reboot the server.</li>
    </ul>
  </li>

  <li><strong>Install SharePoint Server 2019:</strong>
    <ul>
      <li>Run SharePoint 2019 setup <code>setup.exe</code>.</li>
      <li>Enter product key when prompted.</li>
      <li>Choose typical installation.</li>
      <li>Wait for install to finish and reboot if prompted.</li>
    </ul>
  </li>

  <li><strong>Run SharePoint Products Configuration Wizard:</strong>
    <ul>
      <li>Launch the wizard from start menu.</li>
      <li>Create a new farm.</li>
      <li>Specify SQL Server: <code>SQL-Lab.corp.local</code>.</li>
      <li>Use a domain account with SP admin rights (e.g. <code>CORP\spfarm</code>).</li>
      <li>Set farm passphrase.</li>
      <li>Configure SharePoint Central Admin port or accept default.</li>
      <li>Finish the wizard and verify Central Admin site loads.</li>
    </ul>
  </li>

  <li><strong>Create Web Application and Site Collection:</strong>
    <ul>
      <li>From Central Admin, create a new web application.</li>
      <li>Create a new site collection under that web app.</li>
    </ul>
  </li>

  <li><strong>Validate connectivity:</strong>
    <ul>
      <li>Ensure the SharePoint server can communicate with SQL Server and DC.</li>
      <li>Ping both <code>SQL-Lab.corp.local</code> and <code>DC-Lab.corp.local</code>.</li>
    </ul>
  </li>

  <li><strong>IMPORTANT:</strong> Fully patch SharePoint Server and Windows before testing.</li>
</ol>

<div class="section-marker">Finish: SP-Lab Installation</div>

<hr />

<h2>4. PoC Exploit Test of SharePoint 2019 (Proof of Concept)</h2>

<div class="section-marker">PoC Exploit Setup and Run</div>

<p>To perform a Proof of Concept test for a specific SharePoint vulnerability (for example, CVE-2022-21907), follow these steps carefully:</p>

<ol>
  <li><strong>Prepare your testing environment:</strong>
    <ul>
      <li>Ensure SharePoint is installed and fully patched (or intentionally unpatched for exploit testing).</li>
      <li>Use a lab network isolated from production.</li>
    </ul>
  </li>

  <li><strong>Obtain the PoC exploit code:</strong>
    <ul>
      <li>Example PoC repositories for SharePoint vulnerabilities can be found on GitHub or security forums.</li>
      <li>Download or clone the PoC repository.</li>
    </ul>
  </li>

  <li><strong>Run the exploit:</strong>
    <ul>
      <li>On an attacking machine or SP-Lab, open a terminal (PowerShell, cmd, or bash).</li>
      <li>Navigate to the PoC directory.</li>
      <li>Run the Python PoC script with appropriate arguments, for example:</li>
      <pre><code class="cmd">python exploit.py --target http://sp-lab.corp.local --user CORP\username --password YourPassword</code></pre>
      <li>Adjust parameters accordingly.</li>
      <li>Monitor SharePoint logs and behavior during testing.</li>
    </ul>
  </li>

  <li><strong>Analyze results:</strong>
    <ul>
      <li>If exploit is successful, you may get a reverse shell, command execution, or other impact depending on vulnerability.</li>
      <li>Document findings carefully for security reporting.</li>
    </ul>
  </li>

  <li><strong>Mitigation:</strong>
    <ul>
      <li>Apply latest SharePoint security patches.</li>
      <li>Review permissions and configurations.</li>
    </ul>
  </li>

  <li><strong>Official PoC for CVE-2025-47166:</strong>
    <ul>
      <li>The PoC code is publicly available on GitHub at <a href="https://github.com/nu11secur1ty/CVE-mitre/tree/main/2025/CVE-2025-47166" target="_blank" rel="noopener noreferrer">nu11secur1ty/CVE-mitre CVE-2025-47166</a>.</li>
      <li>Clone the repository:</li>
      <pre><code class="cmd">git clone https://github.com/nu11secur1ty/CVE-mitre.git
cd CVE-mitre/2025/CVE-2025-47166</code></pre>
      <li>Run the exploit script as described in the README. Example:</li>
      <pre><code class="cmd">python3 CVE-2025-47166.py --target http://sp-lab.corp.local --user CORP\username --password YourPassword</code></pre>
      <li>Ensure Python 3 and required modules are installed before running.</li>
    </ul>
  </li>
</ol>

<div class="section-marker">End of PoC Exploit Test Guide</div>

</body>
</html>
